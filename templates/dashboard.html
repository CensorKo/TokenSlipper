{% extends "base.html" %}

{% block title %}æ¦‚è§ˆ - TokenSlipper ç®¡ç†åå°{% endblock %}

{% block page_title %}ğŸ“Š æ¦‚è§ˆ{% endblock %}

{% block content %}
<!-- ç»Ÿè®¡å¡ç‰‡ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon blue">ğŸ“Š</div>
        <div class="stat-content">
            <h3>{{ stats.total_requests }}</h3>
            <p>æ€»è¯·æ±‚æ•°</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon green">ğŸ’¬</div>
        <div class="stat-content">
            <h3>{{ stats.total_messages }}</h3>
            <p>æ€»æ¶ˆæ¯æ•°</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon purple">ğŸ”¤</div>
        <div class="stat-content">
            <h3>{{ stats.total_tokens or 0 }}</h3>
            <p>æ€» Token æ¶ˆè€—</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon orange">â±ï¸</div>
        <div class="stat-content">
            <h3>{{ stats.avg_latency }}s</h3>
            <p>å¹³å‡å“åº”æ—¶é—´</p>
        </div>
    </div>
</div>

<!-- æœ€è¿‘è¯·æ±‚ -->
<div class="card">
    <div class="card-header">
        <h2>ğŸ“‹ æœ€è¿‘è¯·æ±‚</h2>
        <a href="/admin/requests" class="btn btn-secondary btn-sm">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
    </div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>æ—¶é—´</th>
                    <th>æ¨¡å‹</th>
                    <th>æ¶ˆæ¯æ•°</th>
                    <th>Tokens</th>
                    <th>è€—æ—¶</th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for req in recent_requests %}
                <tr>
                    <td>{{ req.timestamp.strftime('%m-%d %H:%M:%S') }}</td>
                    <td>
                        <div>{{ req.model_requested }}</div>
                        {% if req.model_requested != req.model_mapped %}
                        <div style="font-size: 12px; color: #667eea;">â†’ {{ req.model_mapped }}</div>
                        {% endif %}
                    </td>
                    <td>{{ req.message_count }}</td>
                    <td>
                        {% if req.response %}
                            {{ req.response.total_tokens or '-' }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if req.response %}
                            {{ "%.2f"|format(req.response.total_latency) }}s
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if req.response %}
                            {% if req.response.status_code == 200 %}
                                <span class="badge badge-success">æˆåŠŸ</span>
                            {% else %}
                                <span class="badge badge-error">é”™è¯¯ {{ req.response.status_code }}</span>
                            {% endif %}
                        {% else %}
                            <span class="badge badge-warning">å¤„ç†ä¸­</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="/admin/request/{{ req.request_id }}" class="btn btn-primary btn-sm">è¯¦æƒ…</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡ -->
<div class="card">
    <div class="card-header">
        <h2>ğŸ¤– æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡</h2>
    </div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>æ¨¡å‹</th>
                    <th>è¯·æ±‚æ¬¡æ•°</th>
                    <th>å æ¯”</th>
                </tr>
            </thead>
            <tbody>
                {% for model in model_stats %}
                <tr>
                    <td><code>{{ model.model_mapped or 'Unknown' }}</code></td>
                    <td>{{ model.count }}</td>
                    <td>{{ "%.1f"|format(model.count / stats.total_requests * 100) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
